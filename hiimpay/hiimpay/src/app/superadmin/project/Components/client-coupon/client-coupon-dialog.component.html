<div class="create-coupon-dialog">
  <h2 class="title">{{ title }}</h2>
  <p class="subtitle">Choose your preferred method to add coupons</p>

  <div class="tabs">
    <button class="tab" [class.active]="activeTab==='manual'" (click)="switchTab('manual')">Manual Entry</button>
    <button class="tab" [class.active]="activeTab==='excel'" (click)="switchTab('excel')">Excel Upload</button>
    <button class="tab" [class.active]="activeTab==='api'" (click)="switchTab('api')">API Integration</button>
  </div>

  <form *ngIf="activeTab==='manual'" [formGroup]="couponForm" (ngSubmit)="submit()">
    <section class="section">
      <div class="row">
        <div class="col">
          <label>Coupon Title</label>
          <input formControlName="title" class="form-control">
        </div>
        <div class="col">
          <label>Coupon Code</label>
          <div class="d-flex">
            <input formControlName="code" class="form-control" [readonly]="!manualCode">
            <button type="button" class="btn btn-outline-secondary ms-2" (click)="generateCode()">Generate</button>
            <button type="button" class="btn btn-link ms-2" (click)="toggleManual()">{{ manualCode ? 'Auto' : 'Manual' }}</button>
          </div>
        </div>
      </div>

      <div class="row mt-2">
        <div class="col">
          <label>Category</label>
          <select formControlName="category" class="form-control">
            <option *ngFor="let category of categories" [value]="category">{{ category }}</option>
          </select>
        </div>
        <div class="col">
          <label>Discount Type</label>
          <select formControlName="discountType" class="form-control">
            <option>Percentage</option>
            <option>Flat Amount</option>
          </select>
        </div>
        <div class="col">
          <label>Discount Value</label>
          <input type="number" formControlName="discountValue" class="form-control">
        </div>
      </div>

      <div class="row mt-2">
        <div class="col">
          <label>Start Date</label>
          <input type="date" formControlName="startDate" class="form-control">
        </div>
        <div class="col">
          <label>Expiry Date</label>
          <input type="date" formControlName="expiryDate" class="form-control">
        </div>
      </div>
    </section>

    <div class="actions">
      <button type="button" class="btn btn-secondary" (click)="cancel()">Cancel</button>
      <button type="submit" class="btn btn-primary" [disabled]="couponForm.invalid">Save Coupon</button>
    </div>
  </form>

  <div *ngIf="activeTab==='excel'" class="tab-content">
    <div class="upload-box" (click)="fileInput.click()">
      <input type="file" #fileInput hidden accept=".xlsx,.xls" (change)="onExcelSelect($event)">
      <div class="drop-zone">
        <div class="upload-text">Drag and drop file here</div>
        <div class="upload-subtext">or click to browse</div>
      </div>
    </div>
    <div class="actions">
      <button class="btn btn-secondary" (click)="cancel()">Cancel</button>
      <button class="btn btn-primary">Upload Excel</button>
    </div>
  </div>

  <div *ngIf="activeTab==='api'" class="tab-content">
    <div class="api-box">
      <h4>API Integration</h4>
      <p>Select one provider, configure auth and data endpoints, then save/pull.</p>
    </div>

    <label>API Profile</label>
    <select [ngModel]="selectedApiProfileId" (ngModelChange)="onApiProfileChange($event)">
      <option *ngFor="let profile of apiProfiles" [ngValue]="profile.id">{{ profile.name }}</option>
    </select>
    <small class="hint">{{ selectedApiProfileDescription }}</small>

    <div class="api-endpoint-card" *ngFor="let endpoint of apiEndpoints; let i = index">
      <div class="api-endpoint-header">
        <strong>{{ endpoint.type === 'auth' ? 'Auth API' : 'Data API' }}</strong>
        <button type="button" class="btn btn-outline-secondary btn-sm" (click)="removeEndpoint(i)">Remove</button>
      </div>

      <div class="row">
        <div class="col">
          <label>Endpoint Name</label>
          <input type="text" class="form-control" [(ngModel)]="endpoint.name">
        </div>
        <div class="col">
          <label>Method</label>
          <select class="form-control" [(ngModel)]="endpoint.method">
            <option value="GET">GET</option>
            <option value="POST">POST</option>
          </select>
        </div>
      </div>

      <div class="mt-2">
        <label>URL</label>
        <input type="text" class="form-control" [(ngModel)]="endpoint.url" placeholder="https://api.example.com/endpoint">
      </div>

      <div class="row mt-2">
        <div class="col">
          <label>API Key</label>
          <input type="text" class="form-control" [(ngModel)]="endpoint.apiKey">
        </div>
        <div class="col">
          <label>Request Secret</label>
          <input type="text" class="form-control" [(ngModel)]="endpoint.requestSecret">
        </div>
      </div>
    </div>

    <div class="api-action-row">
      <button type="button" class="btn btn-outline-secondary" (click)="addEndpoint('auth')">+ Add Auth API</button>
      <button type="button" class="btn btn-outline-secondary" (click)="addEndpoint('data')">+ Add Data API</button>
    </div>

    <label class="mt-3">Sample Request</label>
    <pre class="code"><code [innerText]="apiSample"></code></pre>

    <div class="actions">
      <button class="btn btn-secondary" (click)="saveApiSetup()">Save API Setup</button>
      <button class="btn btn-primary" [disabled]="pullInProgress" (click)="pullFromApi()">
        {{ pullInProgress ? 'Pulling...' : 'Pull Coupon Data' }}
      </button>
    </div>
    <small class="hint" *ngIf="pullMessage">{{ pullMessage }}</small>
  </div>
</div>
