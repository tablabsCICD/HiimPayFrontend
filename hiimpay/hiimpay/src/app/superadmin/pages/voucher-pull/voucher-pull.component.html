<div class="pull-root">
  <div class="header">
    <h2>Pull Voucher</h2>
    <div class="subtitle">Review voucher details and complete your purchase</div>
  </div>

  <div class="summary-card">
    <div class="left">
      <img *ngIf="brand?.logo" [src]="brand.logo" alt="logo" />
      <div *ngIf="!brand?.logo" class="fallback">{{ brand?.name?.charAt(0) }}</div>
    </div>
    <div class="right">
      <div class="brand-title">{{ brand?.name }}</div>
      <div class="meta">Code: <span class="monospace">{{ brand?.code }}</span></div>
      <div class="meta">Denomination: <strong>{{ brand?.denomination }}</strong></div>
      <div class="meta">Redemption: <strong>{{ brand?.redemption }}</strong></div>
    </div>
  </div>

  <form [formGroup]="form" (ngSubmit)="submit()" class="pull-form">
    <label>External Order ID</label>
    <input matInput formControlName="externalOrderId" placeholder="Enter unique external order ID" />
    <div class="error" *ngIf="f['externalOrderId'].touched && f['externalOrderId'].invalid">Required, alphanumeric only.</div>

    <label>Quantity</label>
    <input type="number" formControlName="quantity" min="1" max="10" />
    <div class="helper">Maximum 10 vouchers per request</div>

    <div *ngIf="brand?.denomination==='Dynamic'">
      <label>Denomination Value ({{brand?.min}} - {{brand?.max}})</label>
      <input type="number" formControlName="denominationValue" />
      <div class="error" *ngIf="f['denominationValue'].touched && f['denominationValue'].invalid">Enter a value within allowed range.</div>
    </div>

    <div class="actions">
      <button class="primary" type="submit" [disabled]="loading || form.invalid"> 
        <span *ngIf="!loading">Pull Voucher</span>
        <span *ngIf="loading">Processing…</span>
      </button>
      <button class="secondary" type="button" (click)="cancel()" [disabled]="loading">Cancel</button>
    </div>
  </form>

  <div class="status" *ngIf="success">
    <div class="ok">✔</div>
    <div>
      <div class="msg">{{ success.message }}</div>
      <div class="details">Brand: {{ success.details.brandId }} • Quantity: {{ success.details.quantity }} • Order: {{ success.details.externalOrderId }}</div>
    </div>
  </div>
</div>
